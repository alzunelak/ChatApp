<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GazaChat App</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#fff;height:100vh;display:flex;flex-direction:column;}
#chatPage,#friendInfoPage{display:flex;flex-direction:column;flex:1;}
.header{display:flex;align-items:center;justify-content:space-between;background:#128C7E;padding:10px;border-bottom:1px solid #ccc;position:relative;}
.header img{width:50px;height:50px;border-radius:50%;cursor:pointer;object-fit:cover;}
.header-info{flex:1;display:flex;flex-direction:column;margin-left:10px;overflow:hidden;}
.header-info h2{margin:0;font-size:16px;cursor:pointer;}
.header-actions{display:flex;align-items:center;gap:15px;}
.header-actions button{background:none;border:none;cursor:pointer;font-size:20px;color:white;}
#chatBox{flex:1;overflow-y:auto;padding:10px;margin-bottom:100px;display:flex;flex-direction:column;gap:6px;}
.msg{max-width:70%;padding:10px 14px;border-radius:18px;background:#f1f1f1;align-self:flex-start;word-break:break-word;}
.msg.self{background:#dcf8c6;align-self:flex-end;}
.msg .meta{display:block;margin-top:4px;font-size:10px;color:#999;text-align:right;}
.msg.system{background:#e1f0ff;color:#333;align-self:center;text-align:center;}
#inputArea{display:flex;align-items:center;position:fixed;bottom:10px;left:10px;width:calc(100% - 20px);z-index:100;}
.input-box{display:flex;flex:1;background:#f1f1f1;border-radius:25px;padding:6px 10px;gap:6px;}
.input-box input{flex:1;border:none;outline:none;font-size:14px;background:transparent;}
.input-buttons button{background:transparent;border:none;font-size:20px;cursor:pointer;color:#128C7E;}
#micBtn{width:40px;height:40px;border-radius:50%;background:#25D366;color:white;border:none;font-size:18px;display:flex;align-items:center;justify-content:center;margin-left:6px;}
.popup{display:none;position:absolute;top:50px;right:10px;background:#fff;border:1px solid #ccc;border-radius:8px;z-index:1000;width:150px;}
.popup div{padding:10px;cursor:pointer;border-bottom:1px solid #eee;}
.popup div:hover{background:#f1f1f1;}
#emojiPicker{position:absolute;bottom:60px;left:10px;background:#fff;border:1px solid #ccc;padding:10px;display:none;max-height:200px;overflow-y:auto;border-radius:8px;}
#emojiPicker span{font-size:20px;padding:5px;cursor:pointer;}
#emojiPicker span:hover{background:#eee;border-radius:5px;}
#attachPopup{display:none;position:absolute;bottom:60px;left:60px;background:#fff;border:1px solid #ccc;border-radius:12px;padding:12px;width:270px;box-shadow:0 6px 18px rgba(0,0,0,0.2);z-index:2000;}
#attachGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
.attachItem{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:10px;border-radius:10px;cursor:pointer;background:#f8f8f8;border:1px solid #eee;text-align:center;font-size:12px;user-select:none;}
.attachItem:hover{background:#f1f1f1;}
.attachItem i{font-size:20px;color:#075E54;}
.attachItem input{display:none;}
#friendInfoPage{display:none;flex-direction:column;padding:20px;background:#f5f5f5;}
.friendHeader{text-align:center;margin-bottom:20px;position:relative;}
.friendHeader img{width:120px;height:120px;border-radius:50%;margin-bottom:10px;object-fit:cover;}
.friendHeader h2{margin:0;font-size:22px;margin-bottom:20px;}
.actionButtons{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px;width:100%;}
.actionButtons button{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px 0;background:#fff;border:1px solid #eee;border-radius:8px;cursor:pointer;}
.actionButtons i{font-size:20px;margin-bottom:5px;}
.settingsContainer{display:flex;flex-direction:column;gap:8px;padding:10px;border-top:1px solid #ccc;border-bottom:1px solid #ccc;background:#fff;border-radius:8px;margin-bottom:15px;}
.settingsContainer button{width:100%;padding:12px 15px;border:none;background:#fff;display:flex;align-items:center;justify-content:space-between;gap:10px;color:#000;font-size:16px;cursor:pointer;border-radius:6px;transition:background 0.2s;}
.settingsContainer button:hover{background:#f1f1f1;}
.settingsContainer i{color:black;font-size:18px;}
.settingsContainer input[type="checkbox"]{transform:scale(1.2);cursor:pointer;}
.backArrow{cursor:pointer;font-size:22px;position:absolute;left:0;top:0;}
.popupBox {
  display:none;
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#fff;padding:20px;width:300px;
  border-radius:12px;z-index:6000;
  box-shadow:0 6px 18px rgba(0,0,0,0.2);
  text-align:center;
}
.popupBox h3 {margin-top:0;}
.popupBox button {
  margin-top:15px;padding:8px 12px;background:#128C7E;
  color:white;border:none;border-radius:6px;cursor:pointer;
}
.switch {position:relative;display:inline-block;width:40px;height:20px;}
.switch input {opacity:0;width:0;height:0;}
.slider {position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:.4s;border-radius:20px;}
.slider:before {position:absolute;content:"";height:16px;width:16px;left:2px;bottom:2px;background:white;transition:.4s;border-radius:50%;}
input:checked + .slider {background:#128C7E;}
input:checked + .slider:before {transform:translateX(20px);}
</style>
</head>
<body>

<!-- CHAT PAGE -->
<div id="chatPage">
  <div class="header">
    <img id="friendPhoto" src="default-profile.png" alt="friend">
    <div class="header-info">
      <h2 id="friendName"></h2>
    </div>
    <div class="header-actions">
      <button id="callBtn"><i class="fa-solid fa-phone"></i></button>
      <button id="menuBtn"><i class="fa-solid fa-ellipsis-vertical"></i></button>
    </div>
    <div class="popup" id="menuPopup">
      <div onclick="openFriendInfo()">View Info</div>
      <div onclick="alert('Muted!')">Mute</div>
      <div onclick="deleteChat()">Delete Chat</div>
      <div onclick="openSettings()">Chat Settings</div>
    </div>
  </div>

  <div id="chatBox">
    <div class="msg system">üîí Messages are end-to-end encrypted</div>
  </div>

  <div id="inputArea">
    <div class="input-box">
      <input id="msgInput" placeholder="Type a message..." autocomplete="off">
      <div class="input-buttons">
        <button id="emojiBtn"><i class="fa-solid fa-face-smile"></i></button>
        <button id="plusBtn"><i class="fa-solid fa-paperclip"></i></button>
      </div>
    </div>
    <button id="micBtn"><i class="fa-solid fa-microphone"></i></button>
  </div>
</div>

<!-- Emoji Picker -->
<div id="emojiPicker">
  <span>üòÄ</span><span>üòÇ</span><span>üòç</span><span>üò≠</span>
  <span>üòé</span><span>üò°</span><span>üëç</span><span>üôè</span>
  <span>üî•</span><span>üéâ</span><span>‚ù§Ô∏è</span>
</div>

<!-- Attachments -->
<div id="attachPopup">
  <div id="attachGrid">
    <label class="attachItem">
      <i class="fa-solid fa-image"></i>
      <span>Gallery</span>
      <input type="file" id="galleryInput" accept="image/*,video/*">
    </label>
    <label class="attachItem">
      <i class="fa-solid fa-camera"></i>
      <span>Camera</span>
      <input type="file" id="cameraInput" accept="image/*,video/*" capture="environment">
    </label>
    <div class="attachItem" id="sendLocation">
      <i class="fa-solid fa-location-dot"></i>
      <span>Location</span>
    </div>
    <label class="attachItem">
      <i class="fa-solid fa-file"></i>
      <span>Document</span>
      <input type="file" id="documentInput" accept=".pdf,.doc,.docx,.txt">
    </label>
    <div class="attachItem" id="sendContact">
      <i class="fa-solid fa-user"></i>
      <span>Contact</span>
    </div>
    <label class="attachItem">
      <i class="fa-solid fa-microphone"></i>
      <span>Audio</span>
      <input type="file" id="audioInput" accept="audio/*">
    </label>
  </div>
</div>

<!-- FRIEND INFO PAGE -->
<div id="friendInfoPage">
  <div class="friendHeader">
    <i class="fa-solid fa-arrow-left backArrow" onclick="backToChat()"></i>
    <img id="infoFriendPhoto" src="default-profile.png" alt="friend">
    <h2 id="infoFriendName">Friend Name</h2>
    <div class="actionButtons">
      <button id="videoCallBtn"><i class="fa-solid fa-video"></i><span>Video Call</span></button>
      <button id="audioCallBtn"><i class="fa-solid fa-phone"></i><span>Audio Call</span></button>
      <button id="searchBtn"><i class="fa-solid fa-magnifying-glass"></i><span>Search</span></button>
    </div>
  </div>

  <div class="settingsContainer">
    <button onclick="openPopup('encryptionPopup')"><i class="fa-solid fa-lock"></i> End-to-End Encryption</button>
    <button onclick="openPopup('meshPopup')"><i class="fa-solid fa-network-wired"></i> Mesh Network Form</button>
    <button onclick="openPopup('chatLockPopup')"><i class="fa-solid fa-paint-roller"></i> Chat Lock</button>
    <button onclick="openPopup('disappearPopup')"><i class="fa-solid fa-shield"></i> Disappearing Messages</button>
  </div>

  <!-- Block & Report -->
  <div class="settingsContainer">
    <div style="display:flex;flex-direction:column;gap:8px;">
      <button class="blockBtn" style="display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:8px;background:#fff;color:#f44336;cursor:pointer;font-weight:bold;">
        <span><i class="fa-solid fa-ban"></i> Block User</span>
      </button>
      <button class="reportBtn" style="display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:8px;background:#fff;color:#ff5722;cursor:pointer;font-weight:bold;">
        <span><i class="fa-solid fa-flag"></i> Report User</span>
      </button>
    </div>
  </div>
</div>

<!-- POPUPS -->
<div id="popupOverlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:5000;"></div>

<div class="popupBox" id="encryptionPopup">
  <h3>End-to-End Encryption</h3>
  <p>Messages are secured with end-to-end encryption.</p>
  <p>Verification completed for this chat.</p>
  <button onclick="closePopup()">Done</button>
</div>

<div class="popupBox" id="meshPopup">
  <h3>Mesh Network Form</h3>
  <p>This chat may use peer-to-peer relay nodes for better privacy.</p>
  <button onclick="closePopup()">Done</button>
</div>

<div class="popupBox" id="chatLockPopup">
  <h3>Chat Lock</h3>
  <label class="switch"><input type="checkbox" id="chatLockSlider"><span class="slider"></span></label>
  <p id="chatLockStatus">Chat Lock: OFF</p>
  <button onclick="closePopup()">Done</button>
</div>

<div class="popupBox" id="disappearPopup">
  <h3>Disappearing Messages</h3>
  <select id="disappearSelect">
    <option value="0">Off</option>
    <option value="1">1 hour</option>
    <option value="24">24 hours</option>
    <option value="168">7 days</option>
  </select>
  <p id="disappearStatus">Current: Off</p>
  <button onclick="closePopup()">Done</button>
</div>

<script>
// ===== USER DATA & DOM =====
const myName="Me", myId="user123";
const friendsList=JSON.parse(localStorage.getItem("friends")||"[]");
const friendParam=new URLSearchParams(window.location.search).get("friend");
const friendObj=friendsList.find(f=>f.name===friendParam);
const friendData={name:friendObj?friendObj.name:(friendParam||"Friend"),photo:friendObj&&friendObj.photo?friendObj.photo:"default-profile.png"};

const friendNameEl=document.getElementById("friendName");
const friendPhotoEl=document.getElementById("friendPhoto");
const infoFriendNameEl=document.getElementById("infoFriendName");
const infoFriendPhotoEl=document.getElementById("infoFriendPhoto");
const chatBox=document.getElementById("chatBox");
const msgInput=document.getElementById("msgInput");

friendNameEl.textContent=friendData.name;
friendPhotoEl.src=friendData.photo; friendPhotoEl.onerror=()=>friendPhotoEl.src="default-profile.png";
infoFriendNameEl.textContent=friendData.name;
infoFriendPhotoEl.src=friendData.photo; infoFriendPhotoEl.onerror=()=>infoFriendPhotoEl.src="default-profile.png";

let messages=JSON.parse(localStorage.getItem(`chat_${friendData.name}`)||"[]");

// ===== UTIL =====
function uid(){ return Date.now().toString(36)+'-'+Math.random().toString(36).slice(2,8); }
function timeNow(){ return new Date().toLocaleTimeString(); }
function saveMessages(){ localStorage.setItem(`chat_${friendData.name}`, JSON.stringify(messages)); }
function appendMessageBubble(obj){
  const div=document.createElement("div");
  div.className="msg"+(obj.senderId===myId?" self":"");
  div.innerHTML=`<div>${obj.text}</div><span class="meta">${obj.time}</span>`;
  chatBox.appendChild(div); chatBox.scrollTop=chatBox.scrollHeight;
}
function renderMessages(){ chatBox.innerHTML=""; messages.forEach(appendMessageBubble); }

// ===== POPUP FUNCTIONS =====
function openPopup(id){ document.getElementById("popupOverlay").style.display="block"; document.querySelectorAll(".popupBox").forEach(p=>p.style.display="none"); document.getElementById(id).style.display="block"; }
function closePopup(){ document.getElementById("popupOverlay").style.display="none"; document.querySelectorAll(".popupBox").forEach(p=>p.style.display="none"); }

// ===== CHAT LOCK SLIDER =====
const chatLockSlider=document.getElementById("chatLockSlider");
chatLockSlider.addEventListener("input",()=>{ const status=chatLockSlider.checked?"ON":"OFF"; document.getElementById("chatLockStatus").textContent=`Chat Lock: ${status}`; });

// ===== DISAPPEARING MESSAGES =====
const disappearSelect=document.getElementById("disappearSelect");
disappearSelect.addEventListener("change",()=>{
  const val=disappearSelect.value;
  let text="Off";
  if(val==="1") text="1 hour";
  else if(val==="24") text="24 hours";
  else if(val==="168") text="7 days";
  document.getElementById("disappearStatus").textContent=`Current: ${text}`;
});

// ===== SEND MESSAGE =====
msgInput.addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    e.preventDefault(); const txt=msgInput.value.trim();
    if(!txt) return;
    const msg={id:uid(), senderId:myId, text:txt, time:timeNow()};
    messages.push(msg); saveMessages(); appendMessageBubble(msg); msgInput.value="";
  }
});

// ===== EMOJI =====
const emojiPicker=document.getElementById("emojiPicker");
document.getElementById("emojiBtn").addEventListener("click",()=>{ emojiPicker.style.display=emojiPicker.style.display==="block"?"none":"block"; });
emojiPicker.querySelectorAll("span").forEach(e=>{ e.addEventListener("click",()=>{ msgInput.value+=e.textContent; }); });

// ===== ATTACHMENTS =====
const attachPopup=document.getElementById("attachPopup");
document.getElementById("plusBtn").addEventListener("click",()=>{ attachPopup.style.display=attachPopup.style.display==="block"?"none":"block"; });
["galleryInput","cameraInput","documentInput","audioInput"].forEach(id=>{
  document.getElementById(id).addEventListener("change", e=>{
    if(!e.target.files[0]) return;
    const msg={id:uid(), senderId:myId, text:`[${e.target.files[0].name}]`, time:timeNow()};
    messages.push(msg); saveMessages(); appendMessageBubble(msg); e.target.value="";
  });
});
document.getElementById("sendLocation").addEventListener("click",()=>{
  navigator.geolocation.getCurrentPosition(pos=>{
    const msg={id:uid(), senderId:myId, text:`Location: https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`, time:timeNow()};
    messages.push(msg); saveMessages(); appendMessageBubble(msg);
  },()=>alert("Location access denied"));
});
document.getElementById("sendContact").addEventListener("click",()=>{
  const contact=prompt("Enter contact name:");
  if(contact){ const msg={id:uid(), senderId:myId, text:`Contact: ${contact}`, time:timeNow()}; messages.push(msg); saveMessages(); appendMessageBubble(msg); }
});

// ===== BLOCK & REPORT =====
document.querySelector(".blockBtn").addEventListener("click",()=>{
  if(confirm(`Block ${friendData.name}?`)){
    localStorage.setItem(`blocked_${friendData.name}`, "true"); alert("User blocked!"); backToChat();
  }
});
document.querySelector(".reportBtn").addEventListener("click",()=>{ alert("User reported!"); });

// ===== MENU =====
const menuBtn=document.getElementById("menuBtn"); const menuPopup=document.getElementById("menuPopup");
menuBtn.addEventListener("click",()=>{ menuPopup.style.display=menuPopup.style.display==="block"?"none":"block"; });

// ===== FRIEND INFO PAGE =====
function openFriendInfo(){ document.getElementById("chatPage").style.display="none"; document.getElementById("friendInfoPage").style.display="flex"; }
function backToChat(){ document.getElementById("friendInfoPage").style.display="none"; document.getElementById("chatPage").style.display="flex"; }

// ===== DELETE CHAT =====
function deleteChat(){ if(confirm("Delete chat?")){ messages=[]; saveMessages(); renderMessages(); } }

// ===== INITIALIZE =====
renderMessages();
</script>
</body>
</html>
