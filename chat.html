<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat with Friend</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
body {margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#fff;color:#000;height:100vh;display:flex;flex-direction:column;}
#chatPage,#friendInfoPage{display:flex;flex-direction:column;flex:1;}
.header{display:flex;align-items:center;justify-content:space-between;background:#fff;padding:10px;border-bottom:1px solid #ccc;}
.header img{width:50px;height:50px;border-radius:50%;cursor:pointer;object-fit:cover;}
.header-info{flex:1;display:flex;flex-direction:column;margin-left:10px;overflow:hidden;}
.header-info h2{margin:0;font-size:16px;cursor:pointer;}
.header-actions{display:flex;align-items:center;gap:15px;}
.header-actions button{background:none;border:none;cursor:pointer;font-size:20px;color:#128C7E;}
#chatBox{flex:1;overflow-y:auto;padding:10px;margin-bottom:100px;}
.msg{max-width:70%;padding:10px 14px;margin:5px 0;border-radius:18px;background:#f1f1f1;align-self:flex-start;position:relative;word-break:break-word;}
.msg.self{background:#dcf8c6;align-self:flex-end;}
.msg .meta{font-size:10px;color:#999;text-align:right;}
#inputArea{display:flex;align-items:center;position:fixed;bottom:10px;left:10px;width:calc(100%-20px);z-index:100;}
.input-box{display:flex;flex:1;background:#f1f1f1;border-radius:25px;padding:6px 10px;gap:6px;}
.input-box input{flex:1;border:none;outline:none;font-size:14px;background:transparent;}
.input-buttons button{background:transparent;border:none;font-size:20px;cursor:pointer;color:#128C7E;}
#micBtn{width:40px;height:40px;border-radius:50%;background:#25D366;color:white;border:none;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;margin-left:6px;}
.groupHeader{display:flex;flex-direction:column;align-items:center;padding:15px;background:#fff;color:#000;margin-bottom:10px;border-radius:10px;position:relative;}
.groupHeader img{width:80px;height:80px;border-radius:50%;cursor:default;margin-bottom:10px;object-fit:cover;}
.groupHeader h2{margin:0;font-size:18px;font-weight:500;cursor:default;}
.backArrow{position:absolute;left:10px;top:20px;font-size:20px;cursor:pointer;color:#000;}
.actionButtons{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px;width:100%;}
.actionButtons button{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px 0;background:#fff;border:none;cursor:pointer;}
.actionButtons i{font-size:20px;margin-bottom:5px;}
.settingsContainer{display:flex;flex-direction:column;gap:8px;padding:10px;border-top:1px solid #ccc;border-bottom:1px solid #ccc;background:#fff;border-radius:8px;}
.settingsContainer button{width:100%;padding:12px 15px;border:none;background:#fff;display:flex;align-items:center;justify-content:space-between;gap:10px;color:#000;font-size:16px;cursor:pointer;border-radius:6px;transition:background 0.2s;}
.settingsContainer button:hover{background:#f1f1f1;}
.settingsContainer i{color:black;font-size:18px;}
.settingsContainer input[type="checkbox"]{transform:scale(1.2);cursor:pointer;}
.actionBox{display:flex;flex-direction:column;gap:8px;padding:10px;border-top:1px solid #ccc;border-bottom:1px solid #ccc;}
.actionBox button{width:100%;padding:12px 15px;border:none;display:flex;align-items:center;gap:10px;font-size:16px;cursor:pointer;border-radius:6px;}
.actionBox i{font-size:18px;}
.actionBox .block{background:#ffeded;color:red;}
.actionBox .report{background:#ffeded;color:red;}
.popup{display:none;position:absolute;top:50px;right:10px;background:#fff;border:1px solid #ccc;border-radius:8px;z-index:1000;width:150px;}
.popup div{padding:10px;cursor:pointer;border-bottom:1px solid #eee;}
.popup div:hover{background:#f1f1f1;}

  #emojiPicker {
      position:absolute;
      bottom:60px;
      left:10px;
      background:#fff;
      border:1px solid #ccc;
      padding:10px;
      display:none;
      max-height:200px;
      overflow-y:auto;
      border-radius:8px;
    }
    #emojiPicker span {
      font-size:20px;
      padding:5px;
      cursor:pointer;
    }
    #emojiPicker span:hover {
      background:#eee;
      border-radius:5px;
    }

</style>
</head>
<body>

<!-- CHAT PAGE -->
<div id="chatPage">
  <div class="header">
    <img id="friendPhoto" src="profile.png">
    <div class="header-info">
      <h2 id="friendName"></h2>
    </div>
    <div class="header-actions">
      <button id="callBtn"><i class="fa-solid fa-phone"></i></button>
      <button id="menuBtn"><i class="fa-solid fa-ellipsis-vertical"></i></button>
    </div>
    <div class="popup" id="menuPopup">
      <div onclick="openFriendInfo()">View Info</div>
      <div onclick="alert('Muted!')">Mute</div>
      <div onclick="deleteChat()">Delete Chat</div>
    </div>
  </div>
  <div id="chatBox"></div>
  <div id="inputArea">
    <div class="input-box">
      <input id="msgInput" placeholder="Type a message...">
      <div class="input-buttons">
        <button id="emojiBtn"><i class="fa-solid fa-face-smile"></i></button>
        <button id="plusBtn"><i class="fa-solid fa-paperclip"></i></button>
      </div>
    </div>
    <button id="micBtn"><i class="fa-solid fa-microphone"></i></button>
  </div>
</div>

<!-- Emoji Picker -->
<div id="emojiPicker">
  <span>üòÄ</span>
  <span>üòÇ</span>
  <span>üòç</span>
  <span>üò≠</span>
  <span>üòé</span>
  <span>üò°</span>
  <span>üëç</span>
  <span>üôè</span>
  <span>üî•</span>
  <span>üéâ</span>
  <span>‚ù§Ô∏è</span>
</div>

  
<!-- FRIEND INFO PAGE -->
<div id="friendInfoPage" style="display:none;">
  <div class="groupHeader">
    <i class="fa-solid fa-arrow-left backArrow" onclick="backToChat()"></i>
    <img id="infoFriendPhoto" src="profile.png">
    <h2 id="infoFriendName"></h2>
    <div class="actionButtons">
      <button><i class="fa-solid fa-video"></i><span>Video Call</span></button>
      <button><i class="fa-solid fa-phone"></i><span>Audio Call</span></button>
      <button><i class="fa-solid fa-magnifying-glass"></i><span>Search</span></button>
    </div>
  </div>

  <div class="settingsContainer">
    <button><i class="fa-solid fa-lock"></i> End-to-End Encryption</button>
    <button><i class="fa-solid fa-network-wired"></i> Mesh Network Form</button>
    <button><i class="fa-solid fa-paint-roller"></i> Chat Color & Wallpaper</button>
    <button><i class="fa-solid fa-shield"></i> Advanced Chat Privacy </button>
  </div>

  <div class="actionBox">
    <button class="block" onclick="blockUser()"><i class="fa-solid fa-ban"></i> Block User</button>
    <button class="report" onclick="reportUser()"><i class="fa-solid fa-flag"></i> Report User</button>
  </div>
</div>

<script>
// ===== STATE =====
let myName = "You";
let friendData = JSON.parse(localStorage.getItem("currentFriend")) || {name:"Friend Name", photo:"profile.png"};
let messages = JSON.parse(localStorage.getItem(`chat_with_${friendData.name}`) || "[]");

// ===== HEADER =====
document.getElementById("friendName").textContent = friendData.name;
document.getElementById("friendPhoto").src = friendData.photo;
document.getElementById("infoFriendName").textContent = friendData.name;
document.getElementById("infoFriendPhoto").src = friendData.photo;

// ===== CHAT =====
const chatBox = document.getElementById("chatBox");
const msgInput = document.getElementById("msgInput");

function uid(){ return Date.now().toString(36)+'-'+Math.random().toString(36).slice(2,8); }

msgInput.addEventListener("keydown", e => {
  if(e.key==="Enter"){
    e.preventDefault();
    const txt=msgInput.value.trim();
    if(!txt) return;
    const newMsg = {id:uid(), text:txt, self:true, user:myName, time:new Date().toLocaleTimeString()};
    messages.push(newMsg);
    msgInput.value="";
    renderMessages();
    localStorage.setItem(`chat_with_${friendData.name}`, JSON.stringify(messages));
  }
});

function renderMessages(){
  chatBox.innerHTML="";
  messages.forEach(m=>{
    const div=document.createElement("div");
    div.className="msg"+(m.user===myName?" self":"");
    div.innerHTML=`<div class="content"><b>${m.user}:</b> ${m.text}</div><div class="meta">${m.time}</div>`;
    chatBox.appendChild(div);
  });
  chatBox.scrollTop = chatBox.scrollHeight;
}


 // Emoji picker toggle
  const emojiBtn = document.getElementById("emojiBtn");
  const emojiPicker = document.getElementById("emojiPicker");
  const msgInput = document.getElementById("msgInput");

  emojiBtn.addEventListener("click", () => {
    emojiPicker.style.display = emojiPicker.style.display === "block" ? "none" : "block";
  });

  // Insert emoji into input
  emojiPicker.addEventListener("click", (e) => {
    if (e.target.tagName === "SPAN") {
      msgInput.value += e.target.textContent;
      emojiPicker.style.display = "none"; // close after picking
      msgInput.focus();
    }
  });
  
// ===== MENU POPUP =====
const menuBtn = document.getElementById("menuBtn");
const menuPopup = document.getElementById("menuPopup");
menuBtn.onclick = ()=>{menuPopup.style.display=menuPopup.style.display==="block"?"none":"block";};
document.addEventListener("click", e => {if(!menuBtn.contains(e.target) && !menuPopup.contains(e.target)) menuPopup.style.display="none";});

// ===== NAVIGATION =====
document.getElementById("friendName").onclick = openFriendInfo;
document.getElementById("friendPhoto").onclick = openFriendInfo;
function openFriendInfo(){
  document.getElementById("chatPage").style.display="none";
  document.getElementById("friendInfoPage").style.display="block";
}
function backToChat(){
  document.getElementById("friendInfoPage").style.display="none";
  document.getElementById("chatPage").style.display="flex";
}

// ===== DELETE CHAT =====
function deleteChat(){
  if(confirm("Delete all messages with this friend?")){
    messages = [];
    renderMessages();
    localStorage.removeItem(`chat_with_${friendData.name}`);
  }
}

// ===== BLOCK & REPORT =====
function blockUser(){
  let blocked = JSON.parse(localStorage.getItem("blockedUsers")) || [];
  if(!blocked.includes(friendData.name)){
    blocked.push(friendData.name);
    localStorage.setItem("blockedUsers", JSON.stringify(blocked));
  }
  window.location.href = "home.html"; // back to home after block
}
function reportUser(){
  alert("User reported.");
  window.location.href = "home.html";
}

// ===== INITIAL RENDER =====
renderMessages();
</script>
</body>
</html>
