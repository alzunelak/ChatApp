<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin:0; padding:0; display:flex; flex-direction:column; height:100vh; }
  .chat-header { background:#4CAF50; color:white; padding:15px; text-align:center; }
  .chat-messages { flex:1; overflow-y:auto; padding:15px; }
  .message { margin-bottom:15px; padding:10px; border-radius:8px; max-width:70%; }
  .message.sent { background:#dcf8c6; align-self:flex-end; }
  .message.received { background:#fff; align-self:flex-start; }
  .chat-input { display:flex; padding:10px; border-top:1px solid #ccc; background:#eee; }
  .chat-input input { flex:1; padding:10px; font-size:16px; border-radius:4px; border:1px solid #ccc; }
  .chat-input button { padding:10px 15px; font-size:16px; margin-left:10px; background:#4CAF50; color:white; border:none; border-radius:4px; cursor:pointer; }
  video, img { max-width: 200px; border-radius:8px; display:block; margin-top:5px; }
</style>
</head>
<body>

<div class="chat-header" id="chatHeader">Chat</div>
<div class="chat-messages" id="chatMessages"></div>
<div class="chat-input">
  <input type="text" id="messageInput" placeholder="Type a message...">
  <button id="sendBtn">Send</button>
</div>

<script>
// Get friend from URL
const urlParams = new URLSearchParams(window.location.search);
const friend = urlParams.get('friend') || 'UnknownFriend';
document.getElementById('chatHeader').innerText = `Chat with ${friend}`;

const messagesDiv = document.getElementById('chatMessages');
const input = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');

// Load chat from localStorage
function loadChat(){
  messagesDiv.innerHTML = '';
  const storedMessages = JSON.parse(localStorage.getItem(`chat_${friend}`) || '[]');
  storedMessages.forEach(msg => {
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message', 'received'); // received style for friend
    if(msg.type === 'text'){
      msgDiv.innerText = msg.data;
    } else if(msg.type === 'image'){
      const img = document.createElement('img');
      img.src = msg.data;
      msgDiv.appendChild(img);
    } else if(msg.type === 'video'){
      const video = document.createElement('video');
      video.src = msg.data;
      video.controls = true;
      msgDiv.appendChild(video);
    }
    messagesDiv.appendChild(msgDiv);
  });
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Send a text message
sendBtn.addEventListener('click', () => {
  const text = input.value.trim();
  if(!text) return;

  const storedMessages = JSON.parse(localStorage.getItem(`chat_${friend}`) || '[]');
  storedMessages.push({ type:'text', data: text });
  localStorage.setItem(`chat_${friend}`, JSON.stringify(storedMessages));

  input.value = '';
  loadChat();
});

// Load chat initially
loadChat();
</script>

</body>
</html>
