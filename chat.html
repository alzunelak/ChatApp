<!-- Only content for mainContent -->
<div class="chat-header" id="chatHeader">Chat</div>
<div class="chat-messages" id="chatMessages"></div>
<div class="chat-input">
  <input type="text" id="messageInput" placeholder="Type a message...">
  <button id="sendBtn">Send</button>
</div>

<script>
// Get current friend from localStorage (selected from scanned or searched list)
const friend = localStorage.getItem('selectedFriend') || 'UnknownFriend';
document.getElementById('chatHeader').innerText = `Chat with ${friend}`;

const messagesDiv = document.getElementById('chatMessages');
const input = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');

// Load chat from localStorage
function loadChat(){
  messagesDiv.innerHTML = '';
  const storedMessages = JSON.parse(localStorage.getItem(`chat_${friend}`) || '[]');
  storedMessages.forEach(msg => {
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message', msg.type === 'text' ? 'sent' : 'received'); // style
    if(msg.type === 'text'){
      msgDiv.innerText = msg.data;
    } else if(msg.type === 'image'){
      const img = document.createElement('img');
      img.src = msg.data;
      msgDiv.appendChild(img);
    } else if(msg.type === 'video'){
      const video = document.createElement('video');
      video.src = msg.data;
      video.controls = true;
      msgDiv.appendChild(video);
    }
    messagesDiv.appendChild(msgDiv);
  });
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Send message
sendBtn.addEventListener('click', () => {
  const text = input.value.trim();
  if(!text) return;

  const storedMessages = JSON.parse(localStorage.getItem(`chat_${friend}`) || '[]');
  storedMessages.push({ type:'text', data: text });
  localStorage.setItem(`chat_${friend}`, JSON.stringify(storedMessages));

  input.value = '';
  loadChat();
});

loadChat();
</script>
