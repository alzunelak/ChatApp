<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Join Group</title>
</head>
<body>
<h2>Join Group</h2>
<div id="message"></div>
<script>
let groups = JSON.parse(localStorage.getItem("groups")||"[]");
const params = new URLSearchParams(window.location.search);
const groupName = params.get("group");
const userName = params.get("user");
const msgDiv = document.getElementById("message");

if(!groupName || !userName){ msgDiv.innerText="Invalid invite link."; }
else{
  const group = groups.find(g=>g.name===groupName);
  if(!group) msgDiv.innerText="Group does not exist.";
  else if(group.members.some(m=>m.name===userName)) msgDiv.innerText="You are already a member.";
  else if(!group.invited.includes(userName)) msgDiv.innerText="You were not invited or invite expired.";
  else{
    group.members.push({name:userName,accepted:true});
    group.invited = group.invited.filter(x=>x!==userName);
    localStorage.setItem("groups",JSON.stringify(groups));
    msgDiv.innerHTML=`Welcome ${userName}! You joined <strong>${groupName}</strong>.<br><a href="chat.html">Go to Chat</a>`;
  }
}
</script>
</body>
</html>
