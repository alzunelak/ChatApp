<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Share Friend Link</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
body {
  font-family: Arial;
  background: #000;
  color: #fff;
  text-align: center;
  padding: 20px;
}
input, button {
  padding: 10px;
  margin: 5px;
  font-size: 16px;
  border-radius: 5px;
  border: none;
}
button {
  background: #444;
  color: #fff;
  cursor: pointer;
}
button:hover {
  background: #666;
}
.link-box {
  margin-top: 20px;
  word-break: break-all;
  background: #111;
  padding: 10px;
  border-radius: 5px;
}
</style>
</head>
<body>

<h2>Share Your Friend Link</h2>

<button id="generateLink">Generate Link</button>

<div id="linkContainer" class="link-box"></div>

<script>
const myName = "You"; // Your username
const defaultProfile = "default-profile.png";

// Initialize users in localStorage
if(!localStorage.getItem('users')){
  const initialUsers = [{ name: myName, profile: defaultProfile }];
  localStorage.setItem('users', JSON.stringify(initialUsers));
}

// Generate link
document.getElementById('generateLink').addEventListener('click', () => {
  const user = { name: myName, profile: defaultProfile };
  // Encode user info in URL
  const link = `${window.location.origin}${window.location.pathname}?friend=${encodeURIComponent(JSON.stringify(user))}`;
  document.getElementById('linkContainer').innerHTML = `<a href="${link}" style="color:limegreen;">${link}</a>`;
});

// Check if someone opened the link
window.addEventListener('load', () => {
  const params = new URLSearchParams(window.location.search);
  if(params.has('friend')){
    try {
      const friend = JSON.parse(decodeURIComponent(params.get('friend')));
      let friends = JSON.parse(localStorage.getItem('friends')||'[]');
      if(!friends.some(f=>f.name===friend.name)){
        friends.push(friend);
        localStorage.setItem('friends', JSON.stringify(friends));
        alert(`You are now connected with ${friend.name}!`);
      } else {
        alert(`You are already friends with ${friend.name}`);
      }
    } catch(e) {
      console.error("Invalid friend data");
    }
  }
});
</script>
</body>
</html>
