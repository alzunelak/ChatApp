<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Group Chat</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#eee; }
    .header { background:#007bff; color:white; padding:10px; text-align:center; }
    #chatBox { height:300px; overflow-y:auto; padding:10px; background:white; margin:10px; border-radius:8px; }
    .msg { padding:6px; margin:4px 0; border-radius:6px; background:#f1f1f1; }
    .msg strong { color:#007bff; }
    #msgInput { width:80%; padding:10px; border-radius:20px; border:1px solid #ccc; }
    #sendBtn { padding:10px; border:none; background:#007bff; color:white; border-radius:50%; margin-left:-40px; cursor:pointer; }
    .controls { display:flex; justify-content:space-around; margin:10px; }
    .controls button { padding:8px; border:none; border-radius:6px; cursor:pointer; }
    #members { margin:10px; padding:10px; background:white; border-radius:8px; }
    #groupPhoto { width:100px; height:100px; border-radius:50%; display:block; margin:10px auto; }
  </style>
</head>
<body>
  <div class="header">
    <h2 id="groupName"></h2>
    <img id="groupPhoto" src="" alt="">
  </div>

  <div id="chatBox"></div>

  <div style="display:flex; align-items:center; margin:10px;">
    <input id="msgInput" placeholder="Type a message...">
    <button id="sendBtn">‚û§</button>
  </div>

  <div class="controls">
    <button onclick="sendFile()">üìé File</button>
    <button onclick="sendPhoto()">üñºÔ∏è Photo</button>
    <button onclick="sendVideo()">üé• Video</button>
    <button onclick="sendLocation()">üìç Location</button>
    <button onclick="alert('Voice call coming soon')">üìû Call</button>
    <button onclick="alert('Video call coming soon')">üé• Video Call</button>
  </div>

  <div id="members"></div>

  <script>
    let groups = JSON.parse(localStorage.getItem("groups") || "[]");
    let currentIndex = localStorage.getItem("currentGroup");
    let group = groups[currentIndex];

    document.getElementById("groupName").innerText = group.name;
    document.getElementById("groupPhoto").src = group.photo || "default-group.png";

    function renderMessages(){
      let box = document.getElementById("chatBox");
      box.innerHTML = "";
      group.messages.forEach(m => {
        let div = document.createElement("div");
        div.className = "msg";
        div.innerHTML = `<strong>${m.sender}:</strong> ${m.text}`;
        box.appendChild(div);
      });
      box.scrollTop = box.scrollHeight;
    }

    function renderMembers(){
      let div = document.getElementById("members");
      div.innerHTML = `<h3>Members</h3>`;
      group.members.forEach(m => {
        div.innerHTML += `<p>${m}</p>`;
      });
      if(group.admin === "me"){
        div.innerHTML += `
          <button onclick="blockMember()">Block/Unblock Member</button>
          <button onclick="deleteGroup()">Delete Group</button>
          <button onclick="changePhoto()">Change Group Photo</button>
        `;
      }
    }

    document.getElementById("sendBtn").onclick = () => {
      let txt = document.getElementById("msgInput").value;
      if(!txt) return;
      if(group.blocked.includes("me")) {
        alert("You are blocked by the admin!");
        return;
      }
      group.messages.push({sender:"me", text:txt});
      group.lastMsg = txt;
      group.unread = true;
      document.getElementById("msgInput").value = "";
      save();
      renderMessages();
    };

    function blockMember(){
      let name = prompt("Enter member name to block/unblock:");
      if(!name) return;
      if(group.blocked.includes(name)){
        group.blocked = group.blocked.filter(x => x !== name);
        alert(name + " unblocked");
      } else {
        group.blocked.push(name);
        alert(name + " blocked");
      }
      save();
    }

    function deleteGroup(){
      if(confirm("Delete this group?")){
        groups.splice(currentIndex,1);
        save();
        window.location.href = "groups.html";
      }
    }

    function changePhoto(){
      let url = prompt("Enter new photo URL:");
      if(url){
        group.photo = url;
        save();
        document.getElementById("groupPhoto").src = url;
      }
    }

    function sendFile(){ alert("File sent!"); }
    function sendPhoto(){ alert("Photo sent!"); }
    function sendVideo(){ alert("Video sent!"); }
    function sendLocation(){ alert("Location shared!"); }

    function save(){
      groups[currentIndex] = group;
      localStorage.setItem("groups", JSON.stringify(groups));
    }

    renderMessages();
    renderMembers();
    group.unread = false; // clear unread when opened
    save();
  </script>
</body>
</html>
