<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Group Chat</title>
<style>
body { margin:0; font-family: Arial,sans-serif; background:#f5f5f5; display:flex; flex-direction:column; height:100vh; }
header { background:#25d366; color:white; padding:10px; text-align:center; position:relative; }
header h2 { margin:0; }
header img { width:40px; height:40px; border-radius:50%; vertical-align:middle; margin-right:10px; }
#chatArea { flex:1; padding:10px; overflow-y:auto; display:flex; flex-direction:column; }
.message { background:white; padding:8px 12px; margin:5px 0; border-radius:8px; max-width:70%; align-self:flex-start; position:relative; }
.message.self { background:#dcf8c6; align-self:flex-end; }
.message-time { font-size:10px; color:#888; margin-top:2px; text-align:right; }
.message-options { position:absolute; top:5px; right:5px; font-size:12px; cursor:pointer; color:#555; }
#inputArea { display:flex; padding:10px; background:#fff; }
#inputArea input { flex:1; padding:10px; border:1px solid #ccc; border-radius:20px; outline:none; }
#inputArea button { margin-left:5px; padding:10px 15px; border:none; border-radius:20px; background:#25d366; color:white; cursor:pointer; }
.call-buttons { display:flex; justify-content:flex-end; margin-top:5px; }
.call-buttons button { margin-left:5px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; color:white; }
.call-buttons button.audio { background:#25d366; }
.call-buttons button.video { background:#007bff; }
</style>
</head>
<body>

<header>
  <span><img id="groupProfile" src="default-group.png" alt="Profile"></span>
  <h2 id="groupName">Group</h2>
  <div class="call-buttons">
    <button class="audio" onclick="startGroupCall('audio')">Audio Call</button>
    <button class="video" onclick="startGroupCall('video')">Video Call</button>
  </div>
</header>

<div id="chatArea"></div>

<div id="inputArea">
  <input type="text" id="msgInput" placeholder="Type a message...">
  <button onclick="sendMessage()">Send</button>
</div>

<script>
// Load current group
let currentGroup = JSON.parse(localStorage.getItem("currentGroup") || '{"name":"Group","members":[],"id":"group_default"}');
document.getElementById("groupName").innerText = currentGroup.name;

// Load messages
let messages = JSON.parse(localStorage.getItem("groupMessages_"+currentGroup.id) || "[]");
const chatArea = document.getElementById("chatArea");

function saveMessages(){ localStorage.setItem("groupMessages_"+currentGroup.id, JSON.stringify(messages)); }

function renderMessages(){
  chatArea.innerHTML = "";
  messages.forEach((m, idx)=>{
    const div = document.createElement("div");
    div.className = "message" + (m.sender===localStorage.getItem("username")?' self':'');
    div.innerHTML = `<div>${m.sender}: ${m.text}</div><div class="message-time">${m.time}</div>`;
    // Add delete option for own messages
    if(m.sender===localStorage.getItem("username")){
      const del = document.createElement("span");
      del.className="message-options";
      del.innerText="â‹®";
      del.onclick = ()=>{
        const choice = prompt("Delete message:\n1=Delete for me\n2=Delete for everyone");
        if(choice==='1'){
          messages.splice(idx,1); saveMessages(); renderMessages();
        } else if(choice==='2'){
          messages.splice(idx,1); saveMessages(); renderMessages();
          alert('Deleted for everyone'); // simulate removing from others
        }
      };
      div.appendChild(del);
    }
    chatArea.appendChild(div);
  });
  chatArea.scrollTop = chatArea.scrollHeight;
}
renderMessages();

function sendMessage(){
  const input = document.getElementById("msgInput");
  const text = input.value.trim();
  if(!text) return;
  const msg = {sender: localStorage.getItem("username") || "You", text, time:new Date().toLocaleTimeString()};
  messages.push(msg);
  saveMessages();
  input.value="";
  renderMessages();
}

function startGroupCall(mode){
  if(currentGroup.members.length===0){
    alert("No members to call");
    return;
  }
  alert(`${mode==='audio'?'Audio':'Video'} call started with: ${currentGroup.members.join(', ')}`);
}
</script>

</body>
</html>
