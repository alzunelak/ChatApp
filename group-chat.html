<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Group Chat</title>
<style>
body{font-family:Arial;margin:0;background:#e5ddd5;height:100vh;display:flex;flex-direction:column;}
.header{background:#25d366;color:white;text-align:center;padding:10px;position:relative;}
.header img{width:80px;height:80px;border-radius:50%;margin-top:5px;cursor:pointer;}
.header h2{margin:5px 0;cursor:pointer;}
#members{display:flex;flex-wrap:wrap;justify-content:center;margin:5px;}
#members div{background:#128C7E;color:white;padding:5px 10px;border-radius:15px;margin:2px;position:relative;}
#members div span{cursor:pointer;margin-left:5px;}
#chatBox{flex:1;overflow-y:auto;padding:10px;background:#ece5dd;margin:0 10px;border-radius:8px; margin-bottom:80px;}
.msg{background:white;padding:8px 12px;margin:5px 0;border-radius:8px;display:flex;align-items:center;position:relative;cursor:pointer;}
.msg.self{background:#dcf8c6;align-self:flex-end;}
.msg img{width:30px;height:30px;border-radius:50%;margin-right:5px;}
#inputArea{
  display:flex;
  padding:10px;
  background:white;
  border-radius:25px;
  align-items:center;
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  box-sizing:border-box;
  z-index:100;
}
#inputArea input{flex:1;padding:10px;border-radius:20px;border:1px solid #ccc;}
#inputArea button{margin-left:5px;padding:10px 12px;border:none;border-radius:50%;background:#25d366;color:white;cursor:pointer;}
#topAdd{position:absolute;right:10px;top:10px;cursor:pointer;font-size:20px;background:white;color:#25d366;border-radius:6px;padding:3px 6px;}
#topMenu{display:none;position:absolute;top:40px;right:10px;background:white;padding:10px;border-radius:10px;box-shadow:0 0 5px #888;flex-direction:column;}
#topMenu button{margin:3px;padding:8px;border:none;border-radius:6px;background:#128C7E;color:white;cursor:pointer;}
#friendPopup{display:none;position:absolute;top:50px;right:10px;background:white;padding:10px;border-radius:8px;box-shadow:0 0 5px #888;max-height:200px;overflow-y:auto;flex-direction:column;}
#friendPopup button{width:100%;padding:6px 10px;margin:3px 0;border:none;border-radius:5px;background:#128C7E;color:white;cursor:pointer;}
#friendPopup button:hover{background:#0d6b61;}
/* Attachment Menu */
#attachmentMenu {
  display: none;
  position: fixed;
  bottom: 60px;
  right: 10px;
  background: #fff;
  padding: 10px;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  z-index: 101;
}
#attachmentMenu div{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;}
#attachmentMenu button{
  padding: 10px;
  border: none;
  border-radius: 8px;
  background: #128C7E;
  color: white;
  cursor: pointer;
  font-size: 16px;
  transition: background 0.2s;
}
#attachmentMenu button:hover{background:#0d6b61;}

/* Message options menu */
.msgOptions {
  display:none;
  position:absolute;
  top:-50px;
  right:0;
  background:white;
  border-radius:8px;
  box-shadow:0 0 5px #888;
  z-index:102;
  flex-direction:column;
}
.msgOptions button{
  padding:5px 10px;
  border:none;
  background:#128C7E;
  color:white;
  margin:2px 0;
  border-radius:5px;
  cursor:pointer;
}
.msgOptions button:hover{background:#0d6b61;}
</style>
</head>
<body>

<div class="header">
  <h2 id="groupName"></h2>
  <img id="groupPhoto" src="">
  <div id="members"></div>
  <div id="topAdd">+</div>
  <div id="topMenu">
    <button id="addFriendBtn">‚ûï Add Friend</button>
    <button id="inviteBtn">üì© Invite</button>
    <button id="leaveBtn">üö™ Leave Group</button>
    <button id="deleteBtn" style="display:none;">üóëÔ∏è Delete Group</button>
  </div>
</div>

<div id="friendPopup"></div>
<div id="chatBox"></div>

<div id="inputArea">
  <input id="msgInput" placeholder="Type a message...">
  <button id="sendBtn">‚û§</button>
  <button id="plusBtn">+</button>

  <!-- Attachment Menu -->
  <div id="attachmentMenu">
    <div>
      <button id="sendFileBtn">üìé File</button>
      <button id="takePhotoBtn">üñºÔ∏è Photo</button>
      <button id="takeVideoBtn">üé• Video</button>
      <button id="sendLocationBtn">üìç Location</button>
      <button id="audioCallBtn">üìû Audio Call</button>
      <button id="videoCallBtn">üé• Video Call</button>
    </div>
  </div>
</div>

<script>
let groups = JSON.parse(localStorage.getItem("groups")||"[]");
let currentIndex = localStorage.getItem("currentGroupIndex")||0;
let group = groups[currentIndex]||{name:"My Group",photo:"profile.png",members:[],messages:[],admin:"You",invited:[],blocked:[]};
const myName="You";

// Render group info
document.getElementById("groupName").innerText = group.name;
document.getElementById("groupPhoto").src = group.photo || "profile.png";
if(group.admin===myName) document.getElementById("deleteBtn").style.display="block";

// Members
function renderMembers(){
  const div=document.getElementById("members"); div.innerHTML="";
  group.members.filter(m=>m.accepted).forEach(m=>{
    const mDiv=document.createElement("div"); mDiv.textContent=m.name;
    if(group.admin===myName && m.name!==myName){
      const span=document.createElement("span"); 
      span.textContent = group.blocked.includes(m.name) ? "üö´" : "‚≠ï";
      span.onclick=()=>{ 
        if(group.blocked.includes(m.name)) group.blocked=group.blocked.filter(x=>x!==m.name); 
        else group.blocked.push(m.name); 
        saveGroup(); renderMembers(); renderMessages(); checkBlockedStatus(); 
      }; 
      mDiv.appendChild(span);
    }
    div.appendChild(mDiv);
  });
}

// Chat messages
const chatBox=document.getElementById("chatBox");
function renderMessages(){
  chatBox.innerHTML="";
  group.messages.forEach((m,index)=>{
    if(group.blocked.includes(m.sender)) return;
    const div=document.createElement("div");
    div.className="msg"+(m.sender===myName?" self":"");
    div.dataset.index=index;
    div.innerHTML=`<img src="profile.png"><strong>${m.sender}:</strong> ${m.text||"<i>This message was deleted</i>"}`;

    // Message options menu
    const options=document.createElement("div");
    options.className="msgOptions";
    const btnDeleteMe=document.createElement("button"); btnDeleteMe.textContent="Delete for me";
    const btnDeleteAll=document.createElement("button"); btnDeleteAll.textContent="Delete for everyone";

    btnDeleteMe.onclick = (e)=>{
      e.stopPropagation();
      group.messages.splice(index,1); saveGroup(); renderMessages();
    };
    btnDeleteAll.onclick = (e)=>{
      e.stopPropagation();
      group.messages[index].text="<i>This message was deleted</i>"; saveGroup(); renderMessages();
    };

    options.appendChild(btnDeleteMe);
    options.appendChild(btnDeleteAll);
    div.appendChild(options);

    div.onclick = (e)=>{
      e.stopPropagation();
      const visible = options.style.display==='flex';
      document.querySelectorAll('.msgOptions').forEach(mo=>mo.style.display='none');
      options.style.display = visible ? 'none' : 'flex';
    };

    chatBox.appendChild(div);
  });
  chatBox.scrollTop=chatBox.scrollHeight;
}

// Send message
document.getElementById("sendBtn").onclick=()=>{
  const txt=document.getElementById("msgInput").value.trim();
  if(!txt || group.blocked.includes(myName)) return;
  group.messages.push({sender:myName,text:txt});
  document.getElementById("msgInput").value="";
  saveGroup(); renderMessages();
}

// Disable input if blocked
function checkBlockedStatus(){
  const input=document.getElementById("msgInput");
  const btn=document.getElementById("sendBtn");
  if(group.blocked.includes(myName)){
    input.disabled=true; input.placeholder="‚ùå You are blocked";
    btn.disabled=true; btn.style.opacity="0.5"; btn.style.cursor="not-allowed";
  } else {
    input.disabled=false; input.placeholder="Type a message...";
    btn.disabled=false; btn.style.opacity="1"; btn.style.cursor="pointer";
  }
}

// Save group
function saveGroup(){ groups[currentIndex]=group; localStorage.setItem("groups",JSON.stringify(groups)); }

// Initial render
renderMembers(); renderMessages(); checkBlockedStatus();
</script>

</body>
</html>
