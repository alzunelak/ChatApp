<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Group Chat</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
body { margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#fff;color:#000;height:100vh;display:flex;flex-direction:column; }
#chatPage,#groupInfoPage{display:flex;flex-direction:column;flex:1;}
.header{display:flex;align-items:center;justify-content:space-between;background:#075E54;color:white;padding:10px;}
.header img{width:50px;height:50px;border-radius:50%;cursor:pointer;object-fit:cover;}
.header-info{flex:1;display:flex;flex-direction:column;margin-left:10px;overflow:hidden;}
.header-info h2{margin:0;font-size:16px;cursor:pointer;}
.header-info #members{font-size:12px;color:#d0f0e3;}
#chatBox{flex:1;overflow-y:auto;padding:10px;margin-bottom:100px;}
.msg{max-width:70%;padding:10px 14px;margin:5px 0;border-radius:18px;background:#f1f1f1;align-self:flex-start;position:relative;word-break:break-word;}
.msg.self{background:#dcf8c6;align-self:flex-end;}
.msg .meta{font-size:10px;color:#999;text-align:right;}
#inputArea{display:flex;align-items:center;position:fixed;bottom:10px;left:10px;width:calc(100%-20px);z-index:100;}
.input-box{display:flex;flex:1;background:#f1f1f1;border-radius:25px;padding:6px 10px;gap:6px;}
.input-box input{flex:1;border:none;outline:none;font-size:14px;background:transparent;}
.input-buttons button{background:transparent;border:none;font-size:20px;cursor:pointer;color:#128C7E;}
#micBtn{width:40px;height:40px;border-radius:50%;background:#25D366;color:white;border:none;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;margin-left:6px;}
.groupHeader{display:flex;flex-direction:column;align-items:center;padding:15px;background:#fff;color:#000;margin-bottom:10px;border-radius:10px;position:relative;}
.groupHeader img{width:80px;height:80px;border-radius:50%;cursor:pointer;margin-bottom:10px;object-fit:cover;}
.groupHeader h2{margin:0;font-size:18px;font-weight:500;cursor:text;}
.backArrow{position:absolute;left:10px;top:20px;font-size:20px;cursor:pointer;color:#000;}
.actionButtons{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px;width:100%;}
.actionButtons button{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px 0;background:#fff;border:1px solid #eee;border-radius:8px;cursor:pointer;}
.actionButtons i{font-size:20px;margin-bottom:5px;}
.container{background:#fff;padding:10px;margin:10px;border-radius:10px;}
.settingsContainer{display:flex;flex-direction:column;gap:8px;padding:10px;border-top:1px solid #ccc;border-bottom:1px solid #ccc;background:#fff;border-radius:8px;}
.settingsContainer button{width:100%;padding:12px 15px;border:none;background:#fff;display:flex;align-items:center;justify-content:space-between;gap:10px;color:#000;font-size:16px;cursor:pointer;border-radius:6px;transition:background 0.2s;}
.settingsContainer button:hover{background:#f1f1f1;}
.settingsContainer i{color:black;font-size:18px;}
.settingsContainer input[type="checkbox"]{transform:scale(1.2);cursor:pointer;}
#groupMembersList{display:flex;flex-direction:column;gap:8px;padding:10px;border-top:1px solid #ccc;border-bottom:1px solid #ccc;}
.memberBox{padding:5px 10px;background:#eee;border-radius:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
.membersHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
#memberCount{font-weight:500;font-size:16px;}
#addMemberBtn{width:30px;height:30px;border-radius:50%;background:#128C7E;color:white;font-size:20px;border:none;cursor:pointer;}
#groupLinks{display:flex;flex-direction:column;gap:8px;padding:10px;border-top:1px solid #ccc;border-bottom:1px solid #ccc;}
#groupLinks button{width:100%;padding:10px;border:none;border-radius:5px;background:#fff;color:#000;cursor:pointer;text-align:left;}
.actionBox{display:flex;flex-direction:column;gap:8px;padding:10px;border-top:1px solid #ccc;border-bottom:1px solid #ccc;}
.actionBox button{width:100%;padding:12px 15px;border:none;background:#fff;display:flex;align-items:center;gap:30px;color:red;font-size:16px;cursor:pointer;}
.actionBox i{color:red;font-size:18px;}
.popup {display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:15px;border:1px solid #ccc;border-radius:8px;z-index:1000;width:300px;max-height:400px;overflow-y:auto;}
.popup h3{margin-top:0;}
.popup button.closeBtn{margin-top:10px;float:right;}
.popup div.item{padding:5px;cursor:pointer;border-bottom:1px solid #eee;}
.popup button.unblockBtn{background:#25D366;color:#fff;border:none;border-radius:5px;padding:2px 5px;cursor:pointer;}
/* Popup menu for 3-dot options */
.popupMenu {
  display:none;
  position:absolute;
  right:10px;
  top:60px;
  background:#fff;
  border:1px solid #ccc;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
  z-index:2000;
  width:200px;
}
.popupMenu .menuItem {
  padding:10px;
  cursor:pointer;
  font-size:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}
.emoji { cursor:pointer; font-size:20px; padding:3px; }
#emojiPicker { display:flex; flex-wrap:wrap; gap:5px; background:#fff; border:1px solid #ccc; border-radius:8px; padding:5px; }
</style>
</head>
<body>

<!-- CHAT PAGE -->
<div id="chatPage">
  <div class="header">
    <img id="groupPhoto" src="profile.png">
    <div class="header-info">
      <h2 id="groupName">My Group</h2>
      <div id="members"></div>
    </div>
    <div class="header-actions">
      <button id="callBtn"><i class="fa-solid fa-phone"></i></button>
      <button id="menuBtn"><i class="fa-solid fa-ellipsis-vertical"></i></button>
    </div>
  </div>

<div id="menuPopup" class="popupMenu">
  <div class="menuItem" id="viewInfo"><i class="fa-solid fa-circle-info"></i> View Info</div>
  <div class="menuItem" id="muteChat"><i class="fa-solid fa-bell-slash"></i> Mute</div>
  <div class="menuItem" id="deleteChat"><i class="fa-solid fa-trash"></i> Delete Chat</div>
</div>

<div id="chatBox"></div>

<div id="inputArea">
  <div class="input-box">
    <input id="msgInput" placeholder="Type a message...">
    <div class="input-buttons">
      <button id="emojiBtn"><i class="fa-solid fa-face-smile"></i></button>
      <button id="plusBtn"><i class="fa-solid fa-paperclip"></i></button>
    </div>
  </div>
  <button id="micBtn"><i class="fa-solid fa-microphone"></i></button>
</div>

<!-- Emoji Picker -->
<div id="emojiPicker">
  <span class="emoji">üòÄ</span><span class="emoji">üòÇ</span><span class="emoji">üòç</span><span class="emoji">üòé</span>
  <span class="emoji">üò≠</span><span class="emoji">üëç</span><span class="emoji">üôè</span><span class="emoji">üéâ</span>
</div>

<!-- ATTACHMENT MENU -->
<div id="attachmentMenu" class="popupMenu">
  <div class="menuItem" id="attachGallery"><i class="fa-solid fa-image"></i> Gallery</div>
  <div class="menuItem" id="attachCamera"><i class="fa-solid fa-camera"></i> Camera</div>
  <div class="menuItem" id="attachDocument"><i class="fa-solid fa-file"></i> Document</div>
  <div class="menuItem" id="attachAudio"><i class="fa-solid fa-microphone"></i> Audio</div>
  <div class="menuItem" id="attachContact"><i class="fa-solid fa-address-book"></i> Contact</div>
  <div class="menuItem" id="attachLocation"><i class="fa-solid fa-location-dot"></i> Location</div>
</div>

<!-- FILE INPUTS FOR ATTACHMENTS -->
<input type="file" id="galleryInput" accept="image/*,video/*" style="display:none;">
<input type="file" id="cameraInput" accept="image/*,video/*" capture="camera" style="display:none;">
<input type="file" id="documentInput" accept=".pdf,.doc,.docx,.txt" style="display:none;">
<input type="file" id="audioInput" accept="audio/*" style="display:none;">
<input type="file" id="contactInput" accept=".vcf,.txt" style="display:none;">
<input type="file" id="locationInput" accept=".txt" style="display:none;">

<!-- GROUP INFO PAGE -->
<div id="groupInfoPage" style="display:none;">
<!-- group info content same as before -->
</div>

<!-- POPUPS -->
<div id="linkPopup" class="popup">
  <h3>Invite Link</h3>
  <input type="text" id="groupLinkInput" readonly style="width:100%; padding:5px;">
  <button onclick="copyLink()">Copy</button>
  <button class="closeBtn" onclick="closePopup()">Close</button>
</div>

<div id="blockedPopup" class="popup">
  <h3>Blocked Users</h3>
  <div id="blockedList"></div>
  <button class="closeBtn" onclick="closeBlockedPopup()">Close</button>
</div>

<script>
// ===== STATE =====
let myName = "You";
let groups = JSON.parse(localStorage.getItem("groups") || "[]");
let currentGroupIndex = parseInt(localStorage.getItem("currentGroupIndex") || "-1");
let currentGroup = groups[currentGroupIndex];
if(!currentGroup){ alert("No group selected."); window.location.href="groups.html"; }

let currentUser = myName;
let isAdmin = (currentGroup.admin===myName);
let currentGroupMembers = JSON.parse(localStorage.getItem("currentGroupMembers")) || currentGroup.members.map(m=>m.name);
let blockedMembers = currentGroup.blocked || [];
let messages = currentGroup.messages || [];

// ===== MENU =====
const menuBtn=document.getElementById("menuBtn");
const menuPopup=document.getElementById("menuPopup");
menuBtn.addEventListener("click", e=>{ e.stopPropagation(); menuPopup.style.display=(menuPopup.style.display==="block")?"none":"block"; });
document.addEventListener("click", ()=>{ menuPopup.style.display="none"; attachmentMenu.style.display="none"; emojiPicker.style.display="none"; });

// Menu actions
document.getElementById("viewInfo").onclick=()=>{ openGroupInfo(); menuPopup.style.display="none"; };
document.getElementById("muteChat").onclick=()=>{ alert("Chat muted."); menuPopup.style.display="none"; };
document.getElementById("deleteChat").onclick=()=>{
  if(confirm("Delete all messages?")){ messages=[]; currentGroup.messages=[]; groups[currentGroupIndex]=currentGroup; localStorage.setItem("groups",JSON.stringify(groups)); renderMessages(); }
  menuPopup.style.display="none";
};

// ===== ATTACHMENTS =====
const plusBtn = document.getElementById("plusBtn");
const attachmentMenu = document.getElementById("attachmentMenu");
plusBtn.addEventListener("click", e=>{ e.stopPropagation(); attachmentMenu.style.display=(attachmentMenu.style.display==="block")?"none":"block"; });

// Trigger file inputs
document.getElementById("attachGallery").onclick = () => { document.getElementById("galleryInput").click(); };
document.getElementById("attachCamera").onclick = () => { document.getElementById("cameraInput").click(); };
document.getElementById("attachDocument").onclick = () => { document.getElementById("documentInput").click(); };
document.getElementById("attachAudio").onclick = () => { document.getElementById("audioInput").click(); };
document.getElementById("attachContact").onclick = () => { document.getElementById("contactInput").click(); };
document.getElementById("attachLocation").onclick = () => { document.getElementById("locationInput").click(); };

// Handle attachments
function handleAttachment(file, type){
  const reader=new FileReader();
  reader.onload=()=>{
    const newMsg={id:Date.now(),self:true,user:currentUser,time:new Date().toLocaleString()};
    switch(type){
      case "image": newMsg.text=`<img src="${reader.result}" style="max-width:200px;border-radius:8px;">`; break;
      case "video": newMsg.text=`<video src="${reader.result}" controls style="max-width:200px;"></video>`; break;
      case "audio": newMsg.text=`<audio src="${reader.result}" controls></audio>`; break;
      case "document": newMsg.text=`<a href="${reader.result}" target="_blank">${file.name}</a>`; break;
      case "contact": newMsg.text=`<b>Contact:</b> <a href="${reader.result}" download>${file.name}</a>`; break;
      case "location": newMsg.text=`<b>Location:</b> <pre>${reader.result}</pre>`; break;
    }
    messages.push(newMsg); currentGroup.messages=messages; groups[currentGroupIndex]=currentGroup;
    localStorage.setItem("groups",JSON.stringify(groups)); renderMessages();
  };
  reader.readAsDataURL(file);
}
document.getElementById("galleryInput").addEventListener("change", e=>handleAttachment(e.target.files[0],"image"));
document.getElementById("cameraInput").addEventListener("change", e=>handleAttachment(e.target.files[0],"image"));
document.getElementById("documentInput").addEventListener("change", e=>handleAttachment(e.target.files[0],"document"));
document.getElementById("audioInput").addEventListener("change", e=>handleAttachment(e.target.files[0],"audio"));
document.getElementById("contactInput").addEventListener("change", e=>handleAttachment(e.target.files[0],"contact"));
document.getElementById("locationInput").addEventListener("change", e=>handleAttachment(e.target.files[0],"location"));

// ===== CHAT =====
const chatBox = document.getElementById("chatBox");
const msgInput = document.getElementById("msgInput");
msgInput.addEventListener("keydown", e=>{
  if(e.key==="Enter"){ e.preventDefault(); const txt=msgInput.value.trim(); if(!txt) return;
    messages.push({id:Date.now(),text:txt,self:true,user:currentUser,time:new Date().toLocaleString()});
    msgInput.value=""; currentGroup.messages=messages; groups[currentGroupIndex]=currentGroup; localStorage.setItem("groups",JSON.stringify(groups)); renderMessages();
  }
});
function renderMessages(){ chatBox.innerHTML=""; messages.forEach(m=>{ if(blockedMembers.includes(m.user)) return;
  const div=document.createElement("div"); div.className="msg"+(m.user===currentUser?" self":""); div.innerHTML=`<div class="content"><b>${m.user}:</b> ${m.text}</div><div class="meta">${m.time}</div>`; chatBox.appendChild(div);
}); chatBox.scrollTop=chatBox.scrollHeight; }

// ===== GROUP MEMBERS =====
function renderGroupMembers(){
  const membersDiv=document.getElementById("groupMembersList"); membersDiv.innerHTML="";
  const activeMembers=currentGroupMembers.filter(m=>!blockedMembers.includes(m));
  if(activeMembers.length===0){ const div=document.createElement("div"); div.textContent="No active members"; div.style.fontStyle="italic"; div.style.color="#555"; membersDiv.appendChild(div); }
  else{ activeMembers.forEach(name=>{ const div=document.createElement("div"); div.className="memberBox"; div.textContent=name;
      if(isAdmin && name!==currentUser){ const btn=document.createElement("button"); btn.textContent="Block"; btn.style.marginLeft="10px"; btn.onclick=()=>blockMember(name); div.appendChild(btn); }
      membersDiv.appendChild(div);
    }); }
  document.getElementById("memberCount").textContent=`${activeMembers.length} Member${activeMembers.length!==1?"s":""}`;
  document.getElementById("members").textContent=activeMembers.join(", ");
  currentGroup.members=currentGroupMembers.map(n=>({name:n,accepted:true})); currentGroup.blocked=blockedMembers;
  groups[currentGroupIndex]=currentGroup; localStorage.setItem("groups",JSON.stringify(groups));
}

// ===== EMOJI PICKER =====
const emojiBtn=document.getElementById("emojiBtn");
const emojiPicker=document.getElementById("emojiPicker");
emojiBtn.addEventListener("click", e=>{ e.stopPropagation(); emojiPicker.style.display=(emojiPicker.style.display==="flex")?"none":"flex"; });
emojiPicker.querySelectorAll(".emoji").forEach(span=>{ span.onclick=()=>{ msgInput.value+=span.textContent; emojiPicker.style.display="none"; msgInput.focus(); }});

// ===== BLOCK MEMBER =====
function blockMember(name){ if(confirm(`Block ${name}?`)){ blockedMembers.push(name); renderGroupMembers(); }}

// ===== INIT =====
renderMessages();
renderGroupMembers();
</script>
</body>
</html>
