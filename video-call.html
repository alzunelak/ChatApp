<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Call</title>
<style>
body {
  font-family: Arial;
  margin: 0;
  padding: 0;
  background: #f0f0f0;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
}
.call-container {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  width: 320px;
  position: relative;
}
.call-container img {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  margin-bottom: 10px;
}
.call-container h2 {
  margin: 10px 0;
}
.video-placeholder {
  width: 280px;
  height: 200px;
  background-color: #000;
  margin: 10px auto;
  border-radius: 10px;
  color: #fff;
  display: none;
  align-items: center;
  justify-content: center;
}
.call-buttons button {
  margin: 10px 5px;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
}
.accept-btn { background-color: #4CAF50; color: #fff; }
.decline-btn { background-color: #e74c3c; color: #fff; }
.hangup-btn { background-color: #e74c3c; color: #fff; display: none; }
.call-status { margin: 10px 0; font-weight: bold; }
.ringing {
  animation: ring 1s infinite alternate;
}
@keyframes ring {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
</style>
</head>
<body>

<div class="call-container" id="callContainer">
  <img id="friendProfile" src="default-profile.png" alt="Profile" class="ringing">
  <h2 id="friendName">Friend</h2>
  <div class="call-status" id="callStatus">Incoming Video Call...</div>
  <div class="call-buttons" id="incomingButtons">
    <button class="accept-btn" onclick="acceptCall()">Accept</button>
    <button class="decline-btn" onclick="declineCall()">Decline</button>
  </div>
  <div class="video-placeholder" id="videoPlaceholder">Video Stream</div>
  <div id="callTimer" style="margin:10px 0;font-weight:bold;display:none;">00:00</div>
  <button class="hangup-btn" id="hangupBtn" onclick="hangUp()">Hang Up</button>
</div>

<script>
// Get friend name from URL
const params = new URLSearchParams(window.location.search);
const friendName = params.get('friend') || "Friend";
document.getElementById('friendName').innerText = friendName;

// Load friend's profile from localStorage
const friends = JSON.parse(localStorage.getItem('friends')||'[]');
const friend = friends.find(f => f.name === friendName);
if(friend && friend.profile){
  document.getElementById('friendProfile').src = friend.profile;
}

// Call timer
let timerInterval;
let seconds = 0;
function startTimer(){
  const timerEl = document.getElementById('callTimer');
  timerEl.style.display = 'block';
  timerInterval = setInterval(() => {
    seconds++;
    const mins = String(Math.floor(seconds/60)).padStart(2,'0');
    const secs = String(seconds%60).padStart(2,'0');
    timerEl.innerText = `${mins}:${secs}`;
  }, 1000);
}

// Functions
function acceptCall(){
  document.getElementById('callStatus').innerText = "In Call with " + friendName;
  document.getElementById('incomingButtons').style.display = 'none';
  document.getElementById('videoPlaceholder').style.display = 'flex';
  document.getElementById('hangupBtn').style.display = 'inline-block';
  document.getElementById('friendProfile').classList.remove('ringing');
  startTimer();
}

function declineCall(){
  alert("Call declined");
  window.location.href = "calls.html";
}

function hangUp(){
  clearInterval(timerInterval);
  alert("Call ended with " + friendName);
  window.location.href = "calls.html";
}
</script>

</body>
</html>
