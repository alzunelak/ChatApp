<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Groups</title>
<style>
body { font-family: Arial,sans-serif; margin:0; padding:20px; background:#f5f5f5; }
header { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
header h2 { margin:0; }
button { cursor:pointer; }
.group { padding:10px; background:#fff; margin:5px 0; border-radius:8px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
.group-name { font-weight:bold; }
.delete-btn { background:#f44336; color:white; border:none; padding:5px 8px; border-radius:5px; }
</style>
</head>
<body>

<header>
  <h2>Groups</h2>
  <button id="createGroupBtn">Create Group</button>
</header>

<div id="groupsList"></div>

<script>
// Friends & groups from localStorage
const friends = JSON.parse(localStorage.getItem('friends')||'[]');
let groups = JSON.parse(localStorage.getItem('groups')||'[]');
function saveGroups(){ localStorage.setItem('groups', JSON.stringify(groups)); }

// Render existing groups
function renderGroups(){
  const list = document.getElementById('groupsList');
  list.innerHTML='';
  if(groups.length===0){ list.innerHTML='<p>No groups yet</p>'; return; }

  groups.forEach((g, idx)=>{
    const div = document.createElement('div');
    div.className='group';
    div.innerHTML=`<span class="group-name">${g.name}</span>
      <button class="delete-btn">Delete</button>`;

    // Click group to open chat
    div.onclick = e=>{
      if(!e.target.classList.contains('delete-btn')){
        localStorage.setItem('currentGroup', JSON.stringify(g));
        window.location.href='group-chat.html';
      }
    };

    // Delete group
    div.querySelector('.delete-btn').onclick = ()=>{
      if(confirm(`Delete group "${g.name}"?`)){
        groups.splice(idx,1);
        saveGroups();
        renderGroups();
      }
    };

    list.appendChild(div);
  });
}
renderGroups();

// Create group
document.getElementById('createGroupBtn').addEventListener('click', ()=>{
  if(friends.length===0){ alert('Add friends first'); return; }

  const name = prompt('Enter group name:');
  if(!name) return;

  // Select members (multiple)
  const memberSelection = prompt('Enter friend names separated by comma:\nAvailable: '+friends.map(f=>f.name).join(','));
  if(!memberSelection) return;
  const members = memberSelection.split(',').map(f=>f.trim()).filter(f=>friends.some(fr=>fr.name===f));
  if(members.length===0){ alert('No valid members selected'); return; }

  const group = {id:'group_'+Date.now(), name, members};
  groups.push(group);
  saveGroups();
  renderGroups();
  alert('Group created! Click group to chat.');
});
</script>

</body>
</html>
