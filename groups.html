<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Groups</title>
<style>
body { font-family: Arial,sans-serif; margin:0; padding:20px; background:#f5f5f5; }
.profile-section { display:flex; flex-direction:column; align-items:center; }
.profile-section img { width:80px; height:80px; border-radius:50%; margin-bottom:10px; }
.friend { padding:10px; background:#fff; margin:5px 0; border-radius:8px; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
.selected { background:#c8e6c9; }
button#createGroup { margin-top:10px; padding:10px 20px; cursor:pointer; background:#4CAF50; color:white; border:none; border-radius:6px; }
</style>
</head>
<body>

<div class="profile-section">
  <img id="profilePhoto" src="default-profile.png">
  <h2 id="profileName">User</h2>
</div>

<h3>Select Friends to Add to Group</h3>
<div id="groupFriendsList"></div>
<button id="createGroup">Create Group</button>

<script>
// Profile
const profileName = localStorage.getItem('username') || 'User';
const profilePic = localStorage.getItem('profilePic') || 'default-profile.png';
document.getElementById('profileName').textContent = profileName;
document.getElementById('profilePhoto').src = profilePic;

const selectedFriends = new Set();
const groupList = document.getElementById('groupFriendsList');

function renderGroupFriends(){
  const friends = JSON.parse(localStorage.getItem('friends')||'[]');
  groupList.innerHTML='';
  if(friends.length===0){ groupList.innerHTML='<p>No friends added yet</p>'; return; }
  friends.forEach(f=>{
    const div = document.createElement('div');
    div.className='friend';
    div.innerText=f;
    div.onclick = ()=>{ 
      div.classList.toggle('selected');
      if(selectedFriends.has(f)) selectedFriends.delete(f);
      else selectedFriends.add(f);
    };
    groupList.appendChild(div);
  });
}
renderGroupFriends();

// Create Group
document.getElementById('createGroup').addEventListener('click', ()=>{
  if(selectedFriends.size===0){ alert('Select at least one friend'); return; }
  localStorage.setItem('currentGroup', JSON.stringify({name:'New Group', members:Array.from(selectedFriends), id:'group_'+Date.now()}));
  alert('Group created with: '+Array.from(selectedFriends).join(', '));
  selectedFriends.clear();
  renderGroupFriends();
});

// Broadcast updates
const channel = new BroadcastChannel('chatapp');
channel.onmessage = e=>{
  if(e.data.type==='addFriend') renderGroupFriends();
};
</script>

</body>
</html>
