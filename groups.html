<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Groups</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
body {margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#f5f5f5;}
.header{background:#075E54;color:white;padding:15px;font-size:18px;font-weight:bold;text-align:center;}
.groupList{display:flex;flex-direction:column;}
.groupItem{display:flex;align-items:center;padding:10px;background:#fff;margin:5px 10px;border-radius:8px;cursor:pointer;transition:background 0.2s;}
.groupItem:hover{background:#ececec;}
.groupItem img{width:50px;height:50px;border-radius:50%;object-fit:cover;margin-right:10px;}
.groupInfo{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.groupName{font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.lastMsg{font-size:12px;color:#555;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.memberCount{font-size:12px;color:#999;}
</style>
</head>
<body>

<div class="header">My Groups</div>
<div class="groupList" id="groupList"></div>

<script>
// ===== STATE =====
let groups = JSON.parse(localStorage.getItem("groups") || "[]");

// ===== RENDER GROUPS =====
function renderGroups(){
  const listDiv = document.getElementById("groupList");
  listDiv.innerHTML="";
  if(groups.length===0){
    listDiv.innerHTML="<p style='text-align:center;margin-top:20px;color:#555;'>No groups yet</p>";
    return;
  }

  groups.forEach((g,index)=>{
    const div=document.createElement("div");
    div.className="groupItem";

    // Click to open chat
    div.onclick = ()=>{
      localStorage.setItem("currentGroupIndex", index);
      window.location.href = "group-chat.html";
    };

    const img=document.createElement("img");
    img.src=g.photo || "group.png";

    const infoDiv=document.createElement("div");
    infoDiv.className="groupInfo";

    const nameDiv=document.createElement("div");
    nameDiv.className="groupName";
    nameDiv.textContent=g.name;

    const lastMsgDiv=document.createElement("div");
    lastMsgDiv.className="lastMsg";
    if(g.messages && g.messages.length>0){
      const lastMsg = g.messages[g.messages.length-1];
      lastMsgDiv.textContent = `${lastMsg.user}: ${lastMsg.text}`;
    } else {
      lastMsgDiv.textContent = "No messages yet";
    }

    const memberDiv=document.createElement("div");
    memberDiv.className="memberCount";
    const activeMembers = g.members.filter(m=>!g.blocked?.includes(m.name));
    memberDiv.textContent=`${activeMembers.length} member${activeMembers.length!==1?"s":""}`;

    infoDiv.appendChild(nameDiv);
    infoDiv.appendChild(lastMsgDiv);
    infoDiv.appendChild(memberDiv);

    div.appendChild(img);
    div.appendChild(infoDiv);
    listDiv.appendChild(div);
  });
}

// ===== AUTO REFRESH EVERY 1 SECOND =====
setInterval(()=>{
  groups = JSON.parse(localStorage.getItem("groups") || "[]");
  renderGroups();
},1000);

renderGroups();
</script>
</body>
</html>
