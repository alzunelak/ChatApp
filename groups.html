<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Groups</title>
<style>
body{font-family:Arial;margin:0;padding:20px;background:#f5f5f5;}
.group{display:flex;align-items:center;background:white;padding:10px;margin:10px 0;border-radius:8px;cursor:pointer;position:relative;}
.group img{width:50px;height:50px;border-radius:50%;margin-right:10px;}
.group .info{flex:1;}
.group .info h3{margin:0;font-size:16px;}
.group .info p{margin:0;font-size:12px;color:gray;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.red-dot{position:absolute;right:10px;top:15px;width:10px;height:10px;background:red;border-radius:50%;}
</style>
</head>
<body>

<h1>Your Groups</h1>
<div id="groupsList"></div>

<script>
const groupsListDiv = document.getElementById("groupsList");

// Load all groups from localStorage (for simplicity, only one group here)
let groups = JSON.parse(localStorage.getItem("allGroups") || "[]");

// For testing: add a group if none exists
if(groups.length===0){
  const groupData = JSON.parse(localStorage.getItem("groupData") || "{}");
  if(Object.keys(groupData).length>0){
    groupData.lastRead = null; // Track last read time
    groups.push(groupData);
    localStorage.setItem("allGroups", JSON.stringify(groups));
  }
}

// Render groups
function renderGroups(){
  groupsListDiv.innerHTML="";
  groups.forEach((g,index)=>{
    const div = document.createElement("div");
    div.className="group";
    div.onclick = ()=>{
      // Open chat
      localStorage.setItem("currentGroupIndex", index);
      g.lastRead = new Date().toISOString(); // Reset unread
      localStorage.setItem("allGroups", JSON.stringify(groups));
      window.location="groupChat.html";
    };
    const latestMsg = g.messages.length>0 ? g.messages[g.messages.length-1].text : "No messages yet";

    div.innerHTML = `
      <img src="${g.img||'group.png'}">
      <div class="info">
        <h3>${g.name}</h3>
        <p>${latestMsg}</p>
      </div>
      ${hasUnread(g) ? '<div class="red-dot"></div>' : ''}
    `;
    groupsListDiv.appendChild(div);
  });
}

// Check unread messages
function hasUnread(group){
  if(!group.lastRead) return group.messages.length>0;
  const lastReadTime = new Date(group.lastRead).getTime();
  const lastMsgTime = group.messages.length>0 ? new Date(group.messages[group.messages.length-1].time || new Date()).getTime() : 0;
  return lastMsgTime > lastReadTime;
}

renderGroups();
</script>
</body>
</html>
