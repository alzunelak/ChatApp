<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scan Code</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
body { font-family: Arial, sans-serif; text-align:center; padding:20px; background:#f5f5f5; }
#reader { width:300px; margin:auto; }
#message { margin-top:20px; font-size:16px; color:red; }
</style>
</head>
<body>
<h2>Scan Friend QR Code</h2>
<div id="reader"></div>
<div id="message"></div>

<script>
const users = ["QR1234","QR5678","QR9999"];
const messageDiv = document.getElementById('message');
const channel = new BroadcastChannel('chatapp');

const qrCodeReader = new Html5Qrcode("reader");
qrCodeReader.start({facingMode:"environment"},{fps:10,qrbox:250},
(decodedText)=>{
  if(decodedText){
    if(users.includes(decodedText)){
      messageDiv.style.color="green";
      messageDiv.innerText="Friend found! Adding...";
      // Add to localStorage
      let friends = JSON.parse(localStorage.getItem('friends')||'[]');
      if(!friends.includes(decodedText)){
        friends.push(decodedText);
        localStorage.setItem('friends',JSON.stringify(friends));
        channel.postMessage({type:'addFriend', friend:decodedText});
      }
      qrCodeReader.stop().then(()=>{ messageDiv.innerText="Friend added!"; });
    } else {
      messageDiv.style.color="red";
      messageDiv.innerText="No user exists";
    }
  }
}, (err)=>{console.log(err);});
</script>
</body>
</html>
