<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatApp Home</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
body{ font-family:Arial,sans-serif; margin:0; display:flex; flex-direction:column; height:100vh; background:#f5f5f5;}
.profile-section{display:flex; align-items:center; justify-content:space-between; padding:20px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.profile-info{display:flex; align-items:center; gap:15px;}
.profile-info img{width:60px; height:60px; border-radius:50%; cursor:pointer;}
.profile-info .name{font-size:20px; font-weight:bold;}
.three-dot{font-size:24px; cursor:pointer;}
.middle-section{flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:18px; color:#666;}
.friends-list{margin-top:20px; width:80%;}
.friend{background:#fff; padding:10px; margin-bottom:10px; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,0.1); display:flex; align-items:center;}
.friend img{width:40px; height:40px; border-radius:50%; margin-right:10px;}
.fab{position:fixed; bottom:100px; right:30px; width:60px; height:60px; background:#4CAF50; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:36px; color:#fff; cursor:pointer; box-shadow:0 3px 6px rgba(0,0,0,0.2); z-index:100;}
.popup-menu{position:fixed; bottom:170px; right:30px; background:#fff; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.2); display:none; flex-direction:column; overflow:hidden; z-index:99;}
.popup-menu button{padding:15px 20px; border:none; background:none; text-align:left; cursor:pointer; font-size:16px; width:200px;}
.popup-menu button:hover{background:#f0f0f0;}
.chat-group-call{display:flex; justify-content:space-around; padding:15px; background:#fff; box-shadow:0 -2px 5px rgba(0,0,0,0.1);}
.chat-group-call button{padding:10px 15px; font-size:16px; border:none; border-radius:8px; cursor:pointer; background:#4CAF50; color:#fff;}
#qr-reader{width:100%; max-width:400px; margin-top:20px;}
</style>
</head>
<body>

<div class="profile-section">
  <div class="profile-info">
    <img id="profilePhoto" src="default-profile.png" alt="Profile Picture">
    <div class="name" id="profileName">Name</div>
  </div>
  <div class="three-dot">â‹®</div>
</div>

<div class="middle-section">
  No messages yet, add friends
  <div class="friends-list" id="friendsList"></div>
</div>

<div class="fab" id="fab">+</div>

<div class="popup-menu" id="popupMenu">
  <button id="myCodeBtn">My Code</button>
  <button id="scanCodeBtn">Scan Code</button>
  <button id="searchFriendBtn">Search Friend</button>
  <button id="videoPhotoBtn">Take Video & Photo</button>
</div>

<div class="chat-group-call">
  <button id="chatBtn">Chat</button>
  <button id="groupBtn">Group</button>
  <button id="callBtn">Call</button>
</div>

<div id="qr-reader" style="display:none;"></div>

<script>
// --- Load profile ---
const profileNameEl = document.getElementById('profileName');
const profilePhotoEl = document.getElementById('profilePhoto');
let name = localStorage.getItem('chatapp_username');
let photo = localStorage.getItem('chatapp_userphoto');
if(!name || !photo){ window.location.href='name.html'; }
profileNameEl.textContent = name;
profilePhotoEl.src = photo;

// Change profile photo
profilePhotoEl.addEventListener('click', ()=>{
  const fileInput = document.createElement('input');
  fileInput.type='file'; fileInput.accept='image/*';
  fileInput.onchange = e=>{
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = evt=>{
      profilePhotoEl.src = evt.target.result;
      localStorage.setItem('chatapp_userphoto', evt.target.result);
    }
    reader.readAsDataURL(file);
  }
  fileInput.click();
});

// --- Friends ---
const friendsList = document.getElementById('friendsList');
function getSavedFriends(){ return JSON.parse(localStorage.getItem('chatapp_friends')||'[]'); }
function saveFriends(f){ localStorage.setItem('chatapp_friends', JSON.stringify(f)); }
function renderFriends(){ 
  friendsList.innerHTML=''; 
  getSavedFriends().forEach(n=>{
    const div = document.createElement('div');
    div.className='friend';
    div.innerHTML=`<img src="friend.png"> ${n}`;
    friendsList.appendChild(div);
  });
}
function addFriend(name){ 
  if(!name) return;
  const friends = getSavedFriends();
  if(!friends.includes(name)){
    friends.push(name);
    saveFriends(friends);
    renderFriends();
  }
}
renderFriends();

// --- FAB popup ---
const fab = document.getElementById('fab');
const popupMenu = document.getElementById('popupMenu');
fab.addEventListener('click', ()=>popupMenu.style.display = popupMenu.style.display==='flex'?'none':'flex');

// --- Popup buttons ---
document.getElementById('myCodeBtn').addEventListener('click', ()=>alert("My QR Code!"));
document.getElementById('scanCodeBtn').addEventListener('click', ()=>{
  const qrDiv = document.getElementById('qr-reader'); qrDiv.style.display='block';
  const scanner = new Html5Qrcode("qr-reader");
  scanner.start({facingMode:"environment"}, {fps:10, qrbox:250},
    decodedText=>{ addFriend(decodedText); scanner.stop(); qrDiv.style.display='none'; },
    errorMessage=>{}
  );
});
document.getElementById('searchFriendBtn').addEventListener('click', ()=>{
  const f = prompt("Enter friend's name:"); if(f) addFriend(f);
});
document.getElementById('videoPhotoBtn').addEventListener('click', ()=>{
  const video = document.createElement('video'); video.autoplay=true; video.style.width='100%'; video.style.height='100%';
  document.body.appendChild(video);
  navigator.mediaDevices.getUserMedia({video:true}).then(s=>video.srcObject=s).catch(err=>alert(err));
});

// --- Chat / Group / Call ---
document.getElementById('chatBtn').addEventListener('click', ()=>window.location.href='chat.html');
document.getElementById('groupBtn').addEventListener('click', ()=>window.location.href='group.html');
document.getElementById('callBtn').addEventListener('click', ()=>window.location.href='call.html');
</script>

</body>
</html>
