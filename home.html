<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Home</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
body { margin: 0; font-family: Arial, sans-serif; background: #f2f2f2; }
header { background: #25d366; color: white; padding: 10px; text-align: center; }
header img { width: 60px; height: 60px; border-radius: 50%; display: block; margin: 0 auto 5px; }
.buttons { display: flex; justify-content: space-around; padding: 10px; background: white; }
.buttons button { padding: 10px; background: #25d366; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
.chat-list { padding: 10px; }
.chat-item { background: white; padding: 10px; margin-bottom: 5px; border-radius: 5px; }
nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; justify-content: space-around; border-top: 1px solid #ccc; }
nav a { text-align: center; padding: 10px; flex: 1; color: #555; text-decoration: none; font-size: 14px; }
nav a.active { color: #25d366; }
/* Popup styles */
.popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; }
.popup-content { background: white; padding: 20px; border-radius: 10px; text-align: center; }
.popup-content button { background: red; color: white; padding: 5px 10px; margin-top: 10px; border: none; border-radius: 5px; }
</style>
</head>
<body>

<header>
  <img id="profile-pic" src="default-profile.png" alt="Profile">
  <h2 id="username-display">My Name</h2>
</header>

<div class="buttons">
  <button onclick="showMyCode()">My Code</button>
  <button onclick="startScan()">Scan Code</button>
  <button onclick="location.href='search.html'">Search Friend</button>
</div>

<div class="chat-list" id="chat-list">
  <div class="chat-item">No chats yet. Add a friend to start chatting!</div>
</div>

<nav>
  <a href="home.html" class="active">Chats</a>
  <a href="groups.html">Groups</a>
  <a href="calls.html">Calls</a>
</nav>

<!-- My Code Popup -->
<div class="popup" id="myCodePopup">
  <div class="popup-content">
    <h3>My QR Code</h3>
    <div id="qrcode"></div>
    <button onclick="closeMyCode()">Close</button>
  </div>
</div>

<!-- Scan Popup -->
<div class="popup" id="scanPopup">
  <div class="popup-content">
    <h3>Scan Friend's QR</h3>
    <div id="reader" style="width:250px"></div>
    <button onclick="closeScan()">Close</button>
  </div>
</div>

<script>
const username = localStorage.getItem("username") || "Guest";
document.getElementById("username-display").innerText = username;

const profilePic = localStorage.getItem("profilePic") || "default-profile.png";
document.getElementById("profile-pic").src = profilePic;

// My Code popup
function showMyCode() {
  document.getElementById("myCodePopup").style.display = "flex";
  document.getElementById("qrcode").innerHTML = "";
  new QRCode(document.getElementById("qrcode"), {
    text: username,
    width: 200,
    height: 200
  });
}
function closeMyCode() { document.getElementById("myCodePopup").style.display = "none"; }

// Scan Code
function startScan() {
  document.getElementById("scanPopup").style.display = "flex";
  const html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 200 },
    qrCodeMessage => {
      alert("Scanned: " + qrCodeMessage);
      html5QrCode.stop();
      document.getElementById("scanPopup").style.display = "none";
    },
    errorMessage => {}
  );
}
function closeScan() { document.getElementById("scanPopup").style.display = "none"; }
</script>

</body>
</html>
