<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatApp Home</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
/* --- your exact styles remain unchanged --- */
</style>
</head>
<body>

<div class="profile-section">
  <div class="profile-info">
    <img id="profileImage" src="profile.jpg" alt="Profile Picture">
    <div id="profileName" class="name">Mimah Suleiman</div>
  </div>
  <div class="three-dot">â‹®</div>
</div>

<div class="middle-section">
  No messages yet, add friends
  <div class="friends-list" id="friendsList"></div>
</div>

<div class="fab" id="fab">+</div>

<div class="popup-menu" id="popupMenu">
  <button id="myCodeBtn">My Code</button>
  <button id="scanCodeBtn">Scan Code</button>
  <button id="searchFriendBtn">Search Friend</button>
  <button id="videoPhotoBtn">Take Video & Photo</button>
</div>

<div class="chat-group-call">
  <button id="chatBtn">Chat</button>
  <button id="groupBtn">Group</button>
  <button id="callBtn">Call</button>
</div>

<!-- QR Reader -->
<div id="qr-reader" style="display:none;"></div>

<script>
  // Load saved name & picture from localStorage
  const savedName = localStorage.getItem('userName');
  const savedPic = localStorage.getItem('profilePic');

  if (savedName) {
    document.getElementById('profileName').textContent = savedName;
  }

  if (savedPic) {
    document.getElementById('profileImage').src = savedPic;
  } else {
    document.getElementById('profileImage').src = 'default-icon.png'; // your default icon file
  }

  const fab = document.getElementById('fab');
  const popupMenu = document.getElementById('popupMenu');
  const friendsList = document.getElementById('friendsList');
  let html5QrcodeScanner;

  fab.addEventListener('click', () => {
    popupMenu.style.display = popupMenu.style.display === 'flex' ? 'none' : 'flex';
  });

  document.getElementById('myCodeBtn').addEventListener('click', () => {
    alert("Show my QR code!");
  });

  document.getElementById('scanCodeBtn').addEventListener('click', () => {
    startQRScanner();
  });

  document.getElementById('searchFriendBtn').addEventListener('click', () => {
    const friendName = prompt("Enter friend's name to add:");
    if(friendName) addFriend(friendName);
  });

  document.getElementById('videoPhotoBtn').addEventListener('click', () => {
    openCamera();
  });

  document.getElementById('chatBtn').addEventListener('click', () => alert("Open chat!"));
  document.getElementById('groupBtn').addEventListener('click', () => window.location.href='group.html');
  document.getElementById('callBtn').addEventListener('click', () => window.location.href='call.html');

  function openCamera() {
    const video = document.createElement('video');
    video.style.width = '100%';
    video.style.height = '100%';
    video.autoplay = true;
    document.body.appendChild(video);

    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => { video.srcObject = stream; })
      .catch(err => { alert("Error accessing camera: " + err); });
  }

  function startQRScanner() {
    const qrReaderDiv = document.getElementById('qr-reader');
    qrReaderDiv.style.display = 'block';
    html5QrcodeScanner = new Html5Qrcode("qr-reader");

    html5QrcodeScanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      (decodedText) => {
        addFriend(decodedText);
        html5QrcodeScanner.stop();
        qrReaderDiv.style.display = 'none';
      },
      (errorMessage) => {}
    ).catch(err => { alert("Unable to start QR scanner: " + err); });
  }

  function addFriend(name) {
    const friendDiv = document.createElement('div');
    friendDiv.className = 'friend';
    friendDiv.innerHTML = `<img src="friend.png" alt="Friend"> ${name}`;
    friendsList.appendChild(friendDiv);
  }
</script>

</body>
</html>
