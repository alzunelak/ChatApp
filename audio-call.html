<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audio Call</title>
<style>
body{font-family:Arial;background:#e5ddd5;margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;}
#friendProfile{width:100px;height:100px;border-radius:50%;margin-bottom:20px;border:4px solid #25d366;}
.ringing{animation:ring 1s infinite;}
@keyframes ring{0%{transform:scale(1);}50%{transform:scale(1.1);}100%{transform:scale(1);}}
#controls button{margin:10px;padding:10px 20px;border:none;border-radius:8px;color:white;font-size:16px;cursor:pointer;}
.accept{background:#25d366;}
.decline{background:red;}
.hangup{background:#555;display:none;}
</style>
</head>
<body>
<img id="friendProfile">
<h2 id="friendName"></h2>
<p id="callStatus">Incoming Audio Call...</p>
<p id="timer">00:00</p>
<div id="controls">
  <button id="acceptBtn" class="accept">Accept</button>
  <button id="declineBtn" class="decline">Decline</button>
  <button id="hangupBtn" class="hangup">Hang Up</button>
</div>

<script>
const urlParams=new URLSearchParams(window.location.search);
const friendName=urlParams.get("friend");
const friendImg=urlParams.get("img");
document.getElementById("friendName").innerText=friendName;
document.getElementById("friendProfile").src=friendImg;
document.getElementById("friendProfile").classList.add("ringing");

let timerInterval; let seconds=0;

function formatTime(sec){let m=Math.floor(sec/60);let s=sec%60;return (m<10?"0":"")+m+":"+(s<10?"0":"")+s;}
function startTimer(){timerInterval=setInterval(()=>{seconds++;document.getElementById("timer").innerText=formatTime(seconds);},1000);}

function saveStatus(status){
  const callStatus=JSON.parse(localStorage.getItem("callStatus")||"{}");
  callStatus[friendName]={text:status.text,class:status.class};
  localStorage.setItem("callStatus",JSON.stringify(callStatus));
}

document.getElementById("acceptBtn").onclick=()=>{
  document.getElementById("callStatus").innerText="In Audio Call with "+friendName;
  document.getElementById("acceptBtn").style.display="none";
  document.getElementById("declineBtn").style.display="none";
  document.getElementById("hangupBtn").style.display="inline-block";
  document.getElementById("friendProfile").classList.remove("ringing");
  saveStatus({text:"Audio Call Accepted",class:"accepted"});
  startTimer();
};

document.getElementById("declineBtn").onclick=()=>{
  saveStatus({text:"Call Declined",class:"declined"});
  window.location.href="calls.html";
};

document.getElementById("hangupBtn").onclick=()=>{
  clearInterval(timerInterval);
  saveStatus({text:"Call Ended",class:"declined"});
  window.location.href="calls.html";
};

// Auto Missed if no answer in 25s
setTimeout(()=>{
  if(document.getElementById("acceptBtn").style.display!=="none"){
    saveStatus({text:"Missed Call",class:"missed"});
    window.location.href="calls.html";
  }
},25000);
</script>
</body>
</html>
